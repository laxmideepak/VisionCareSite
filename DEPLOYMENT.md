# GoTo Optical Deployment Guide

## üöÄ Production Database Setup

### Step 1: Choose a PostgreSQL Provider

**Recommended Options:**

1. **Neon Database** (Free tier available)
   - Visit: https://neon.tech
   - Create account and new project
   - Copy connection string

2. **Supabase** (Free tier available)
   - Visit: https://supabase.com
   - Create project and get database URL

3. **Railway** (Usage-based pricing)
   - Visit: https://railway.app
   - Create PostgreSQL service

4. **Render** (Free tier available)
   - Visit: https://render.com
   - Create PostgreSQL database

### Step 2: Set Environment Variables

Copy `env.example` to `.env` and update:

```bash
cp env.example .env
```

Update the `.env` file with your database URL:

```env
DATABASE_URL="your-postgresql-connection-string-here"
JWT_SECRET="your-secure-random-string-here"
```

### Step 3: Run Database Migrations

```bash
# Generate migrations (if schema changed)
npm run db:generate

# Run migrations
npm run db:migrate

# Seed database with initial data
npm run db:seed
```

### Step 4: Test Database Connection

```bash
# Start server with database
npm run dev
```

The server should now connect to PostgreSQL instead of using in-memory storage.

## üåê Deployment Options

### Option 1: Railway (Recommended)

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Add database configuration"
   git push origin main
   ```

2. **Deploy to Railway**
   - Visit https://railway.app
   - Connect GitHub repository
   - Add PostgreSQL service
   - Set environment variables
   - Deploy automatically

3. **Set Environment Variables in Railway:**
   - `DATABASE_URL` (auto-generated by Railway PostgreSQL)
   - `JWT_SECRET` (generate secure random string)
   - `NODE_ENV=production`
   - `FRONTEND_URL` (your Railway app URL)

### Option 2: Vercel + Neon

1. **Database Setup**
   - Create Neon database
   - Run migrations locally with Neon URL

2. **Deploy to Vercel**
   ```bash
   npm install -g vercel
   vercel
   ```

3. **Set Environment Variables in Vercel:**
   - `DATABASE_URL`
   - `JWT_SECRET`
   - `NODE_ENV=production`

### Option 3: Render

1. **Create Web Service on Render**
   - Connect GitHub repository
   - Build command: `npm install && npm run build`
   - Start command: `npm start`

2. **Create PostgreSQL Database on Render**

3. **Set Environment Variables**

## üîß Database Commands

```bash
# Generate new migrations after schema changes
npm run db:generate

# Run migrations
npm run db:migrate

# Seed database with initial data
npm run db:seed

# Reset database (migrate + seed)
npm run db:reset

# Open Drizzle Studio (database GUI)
npm run db:studio

# Push schema directly (dev only)
npm run db:push
```

## üîê Default Admin Accounts

After seeding, these accounts will be available:

- **Admin**: `admin@gotooptical.com` / `admin123`
- **Staff**: `staff@gotooptical.com` / `staff123`

**‚ö†Ô∏è Important**: Change these passwords in production!

## üß™ Testing Database Connection

```bash
# Test API endpoints
curl http://localhost:3000/api/health
curl http://localhost:3000/api/testimonials
curl http://localhost:3000/api/pricing-plans
curl http://localhost:3000/api/services
```

## üìä Database Schema

The database includes:
- **Users** (patients, staff, admins)
- **Patient Profiles** (medical info, insurance)
- **Appointments** (scheduling, status tracking)
- **Contact Submissions** (form submissions)
- **Testimonials** (patient reviews)
- **Pricing Plans** (service packages)
- **Services** (offered services)
- **Notifications** (email/SMS queue)
- **Prescriptions** (medical prescriptions)

## üîÑ Production Checklist

- [ ] Database URL configured
- [ ] JWT secret set (secure random string)
- [ ] Migrations run successfully
- [ ] Database seeded with initial data
- [ ] Admin passwords changed
- [ ] CORS configured for production domain
- [ ] Rate limiting configured
- [ ] SSL/HTTPS enabled
- [ ] Error logging configured
- [ ] Backup strategy implemented

## üêõ Troubleshooting

**Migration Errors:**
```bash
# Check database connection
npm run db:studio

# Reset migrations (CAUTION: destroys data)
# Drop all tables manually, then:
npm run db:reset
```

**Connection Issues:**
- Verify DATABASE_URL format
- Check firewall/network settings
- Ensure database is running
- Verify SSL requirements

**Authentication Issues:**
- Check JWT_SECRET is set
- Verify token expiration settings
- Check CORS configuration
